<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Department Admin Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; }
        .header { background: #2c3e50; color: white; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header h1 { font-size: 28px; font-weight: 700; }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; padding: 20px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .card h3 { color: #2c3e50; margin-bottom: 15px; font-size: 18px; }
        .metric { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; }
        .metric-value { font-size: 24px; font-weight: bold; color: #3498db; }
        .alert-item { padding: 12px; border-left: 4px solid; margin-bottom: 10px; border-radius: 4px; }
        .alert-critical { border-color: #e74c3c; background: #fdf2f2; }
        .alert-high { border-color: #f39c12; background: #fef9e7; }
        .alert-medium { border-color: #f1c40f; background: #fffbf0; }
        .alert-low { border-color: #27ae60; background: #f0f9f4; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .prediction-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .hotspot-card { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .resource-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .status-online { color: #27ae60; }
        .status-offline { color: #e74c3c; }
        #miniMap { height: 200px; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè• Health Department Dashboard</h1>
        <p>Real-time Disease Surveillance & Early Warning System</p>
    </div>

    <div class="dashboard">
        <!-- Key Metrics -->
        <div class="card">
            <h3>üìä Key Metrics</h3>
            <div class="metric">
                <span>Total Reports Today</span>
                <span class="metric-value" id="total-reports">42</span>
            </div>
            <div class="metric">
                <span>Active Alerts</span>
                <span class="metric-value" id="active-alerts" style="color: #e74c3c;">8</span>
            </div>
            <div class="metric">
                <span>Water Sources Monitored</span>
                <span class="metric-value" id="water-sources">156</span>
            </div>
            <div class="metric">
                <span>IoT Sensors Online</span>
                <span class="metric-value status-online" id="sensors-online">23/25</span>
            </div>
        </div>

        <!-- AI Prediction -->
        <div class="card prediction-card">
            <h3>ü§ñ AI Outbreak Prediction</h3>
            <div style="margin-bottom: 15px;">
                <strong>Predicted Disease:</strong> <span id="predicted-disease">Diarrhea</span><br>
                <strong>Risk Level:</strong> <span id="risk-level">HIGH</span><br>
                <strong>Confidence:</strong> <span id="confidence">78%</span><br>
                <strong>Timeline:</strong> <span id="timeline">7-14 days</span>
            </div>
            <button class="btn btn-primary" onclick="updatePrediction()">üîÑ Update Prediction</button>
        </div>

        <!-- Disease Hotspots -->
        <div class="card hotspot-card">
            <h3>üó∫Ô∏è Disease Hotspots</h3>
            <div id="hotspots-list">
                <div style="margin-bottom: 10px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 6px;">
                    <strong>Guwahati Central:</strong> 15 cases (Diarrhea)
                </div>
                <div style="margin-bottom: 10px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 6px;">
                    <strong>Dibrugarh:</strong> 8 cases (Cholera)
                </div>
                <div style="margin-bottom: 10px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 6px;">
                    <strong>Silchar:</strong> 3 cases (Typhoid)
                </div>
            </div>
            <button class="btn btn-primary" onclick="openFullMap()">üó∫Ô∏è View Full Map</button>
        </div>

        <!-- Trend Chart -->
        <div class="card">
            <h3>üìà Disease Trends (Last 7 Days)</h3>
            <canvas id="trendChart" width="400" height="200"></canvas>
        </div>

        <!-- Recent Alerts -->
        <div class="card">
            <h3>üö® Recent Alerts</h3>
            <div id="alerts-container">
                <div class="alert-item alert-critical">
                    <strong>CRITICAL:</strong> High bacterial count in Guwahati water source
                    <br><small>2 minutes ago</small>
                </div>
                <div class="alert-item alert-high">
                    <strong>HIGH:</strong> Diarrhea outbreak reported in Dibrugarh
                    <br><small>15 minutes ago</small>
                </div>
                <div class="alert-item alert-medium">
                    <strong>MEDIUM:</strong> Water turbidity increased in Silchar
                    <br><small>1 hour ago</small>
                </div>
            </div>
        </div>

        <!-- Resource Management -->
        <div class="card">
            <h3>üöë Resource Management</h3>
            <div class="resource-item">
                <span>üíä ORS Packets</span>
                <span><strong>1,250</strong> available</span>
            </div>
            <div class="resource-item">
                <span>üè• Medical Teams</span>
                <span><strong>18</strong> deployed</span>
            </div>
            <div class="resource-item">
                <span>üö∞ Water Testing Kits</span>
                <span><strong>45</strong> in use</span>
            </div>
            <div class="resource-item">
                <span>üöõ Emergency Vehicles</span>
                <span><strong>12</strong> available</span>
            </div>
            <button class="btn btn-success" onclick="allocateResources()">üìã Allocate Resources</button>
        </div>

        <!-- Active Interventions -->
        <div class="card">
            <h3>‚ö° Active Interventions</h3>
            <div class="alert-item alert-high">
                <strong>Water Boiling Campaign</strong><br>
                Status: Active | Coverage: 85% | Target: Guwahati
            </div>
            <div class="alert-item alert-medium">
                <strong>ORS Distribution</strong><br>
                Status: In Progress | Coverage: 60% | Target: Dibrugarh
            </div>
            <div class="alert-item alert-low">
                <strong>Hygiene Awareness Drive</strong><br>
                Status: Completed | Coverage: 100% | Target: Silchar
            </div>
            <button class="btn btn-warning" onclick="createIntervention()">‚ûï Create Intervention</button>
        </div>

        <!-- Mini Map -->
        <div class="card">
            <h3>üó∫Ô∏è Live Situation Map</h3>
            <div id="miniMap"></div>
            <button class="btn btn-primary" onclick="openFullMap()" style="margin-top: 10px;">üîç View Detailed Map</button>
        </div>

        <!-- System Status -->
        <div class="card">
            <h3>‚öôÔ∏è System Status</h3>
            <div class="metric">
                <span>Mobile App Users</span>
                <span class="metric-value status-online">2,847</span>
            </div>
            <div class="metric">
                <span>Data Sync Status</span>
                <span class="status-online">‚úÖ All synced</span>
            </div>
            <div class="metric">
                <span>Server Uptime</span>
                <span class="status-online">99.8%</span>
            </div>
            <div class="metric">
                <span>Last Update</span>
                <span id="last-update">2 minutes ago</span>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="data_bridge.js"></script>
    <script>
        // Initialize trend chart
        const ctx = document.getElementById('trendChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Diarrhea',
                    data: [12, 19, 15, 25, 22, 30, 28],
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Cholera',
                    data: [2, 3, 8, 5, 7, 4, 6],
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Typhoid',
                    data: [1, 2, 1, 3, 2, 1, 2],
                    borderColor: '#f39c12',
                    backgroundColor: 'rgba(243, 156, 18, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Initialize mini map
        const miniMap = L.map('miniMap').setView([26.2006, 92.9376], 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(miniMap);

        // Add sample markers
        L.circleMarker([26.1445, 91.7362], {
            radius: 10, fillColor: '#e74c3c', color: '#fff', weight: 2, fillOpacity: 0.8
        }).addTo(miniMap).bindPopup('Guwahati: 15 cases');

        L.circleMarker([27.4728, 94.9120], {
            radius: 8, fillColor: '#f39c12', color: '#fff', weight: 2, fillOpacity: 0.8
        }).addTo(miniMap).bindPopup('Dibrugarh: 8 cases');

        // Functions
        function updatePrediction() {
            // Get real predictions from data bridge
            const predictions = window.healthDataBridge.getPredictions();
            
            if (predictions && predictions.predictedDisease) {
                document.getElementById('predicted-disease').textContent = predictions.predictedDisease;
                document.getElementById('risk-level').textContent = predictions.riskLevel;
                document.getElementById('confidence').textContent = predictions.confidence + '%';
                document.getElementById('timeline').textContent = predictions.timeline;
            } else {
                // Fallback to mock data
                const diseases = ['Diarrhea', 'Cholera', 'Typhoid', 'Hepatitis A'];
                const risks = ['LOW', 'MEDIUM', 'HIGH', 'CRITICAL'];
                
                document.getElementById('predicted-disease').textContent = diseases[Math.floor(Math.random() * diseases.length)];
                document.getElementById('risk-level').textContent = risks[Math.floor(Math.random() * risks.length)];
                document.getElementById('confidence').textContent = Math.floor(Math.random() * 40 + 60) + '%';
            }
            
            showMessage('AI prediction updated successfully!');
        }
        
        function showMessage(text) {
            // Create a temporary message element
            const msg = document.createElement('div');
            msg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #27ae60; color: white; padding: 15px; border-radius: 8px; z-index: 1000;';
            msg.textContent = text;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }

        function allocateResources() {
            alert('Resource allocation interface would open here.\n\nFeatures:\n- Deploy medical teams\n- Distribute ORS packets\n- Assign water testing kits\n- Coordinate emergency vehicles');
        }

        function createIntervention() {
            alert('Intervention creation interface would open here.\n\nOptions:\n- Water boiling campaigns\n- ORS distribution drives\n- Hygiene awareness programs\n- Medical team deployment');
        }

        function openFullMap() {
            window.open('map_integration.html', '_blank');
        }

        // Subscribe to data bridge updates
        window.healthDataBridge.subscribe((eventType, data) => {
            if (eventType === 'dataSync') {
                updateDashboardData(data);
            } else if (eventType === 'predictionUpdated') {
                updatePredictionDisplay(data);
            } else if (eventType === 'healthReportAdded') {
                updateReportsCount();
            }
        });
        
        function updateDashboardData(data) {
            if (data.statistics) {
                document.getElementById('total-reports').textContent = data.statistics.totalReports || 0;
                document.getElementById('active-alerts').textContent = data.statistics.activeAlerts || 0;
                document.getElementById('water-sources').textContent = data.statistics.waterSources || 0;
            }
            
            // Update hotspots
            if (data.hotspots && data.hotspots.length > 0) {
                updateHotspotsDisplay(data.hotspots);
            }
            
            document.getElementById('last-update').textContent = 'Just now';
        }
        
        function updatePredictionDisplay(predictions) {
            document.getElementById('predicted-disease').textContent = predictions.predictedDisease;
            document.getElementById('risk-level').textContent = predictions.riskLevel;
            document.getElementById('confidence').textContent = predictions.confidence + '%';
            document.getElementById('timeline').textContent = predictions.timeline;
        }
        
        function updateHotspotsDisplay(hotspots) {
            const container = document.getElementById('hotspots-list');
            container.innerHTML = hotspots.slice(0, 3).map(hotspot => `
                <div style="margin-bottom: 10px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 6px;">
                    <strong>${hotspot.location}:</strong> ${hotspot.caseCount} cases (${hotspot.riskLevel} Risk)
                </div>
            `).join('');
        }
        
        function updateReportsCount() {
            const currentCount = parseInt(document.getElementById('total-reports').textContent) || 0;
            document.getElementById('total-reports').textContent = currentCount + 1;
        }
        
        // Auto-refresh data
        setInterval(() => {
            window.healthDataBridge.syncData();
        }, 30000);
        
        // Initialize dashboard with existing data
        window.onload = function() {
            const existingData = window.healthDataBridge.data;
            updateDashboardData(existingData);
            updatePrediction();
        };
    </script>
</body>
</html>